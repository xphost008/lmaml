<!DOCTYPE HTML>
<html lang="zh" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>下载libraries - Let us Make A Minecraft Launcher</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../intro.html">导论</a></li><li class="chapter-item expanded affix "><li class="part-title">目录</li><li class="chapter-item expanded "><a href="../ProgrammingLanguage.html"><strong aria-hidden="true">1.</strong> 编程语言的选择</a></li><li class="chapter-item expanded "><a href="../LaunchPrinciple.html"><strong aria-hidden="true">2.</strong> 启动原理</a></li><li class="chapter-item expanded "><a href="../FirstChapter/intro.html"><strong aria-hidden="true">3.</strong> 第一章：启动游戏</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../FirstChapter/LaunchArguments.html"><strong aria-hidden="true">3.1.</strong> 讲解启动参数</a></li><li class="chapter-item expanded "><a href="../FirstChapter/GetVersionFolder.html"><strong aria-hidden="true">3.2.</strong> 如何获取versions文件夹</a></li><li class="chapter-item expanded "><a href="../FirstChapter/GetJVMAndArgument.html"><strong aria-hidden="true">3.3.</strong> 如何获取jvm、game参数</a></li><li class="chapter-item expanded "><a href="../FirstChapter/GetCpLibraries.html"><strong aria-hidden="true">3.4.</strong> 如何获取cp-library值</a></li><li class="chapter-item expanded "><a href="../FirstChapter/SupportInheritsFrom.html"><strong aria-hidden="true">3.5.</strong> 支持inheritsFrom下的MC</a></li><li class="chapter-item expanded "><a href="../FirstChapter/LaunchGame/LaunchIntro.html"><strong aria-hidden="true">3.6.</strong> 启动游戏！</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../FirstChapter/LaunchGame/ReplaceTemplate.html"><strong aria-hidden="true">3.6.1.</strong> 替换字符串模板并启动游戏</a></li><li class="chapter-item expanded "><a href="../FirstChapter/LaunchGame/UnzipNative.html"><strong aria-hidden="true">3.6.2.</strong> 解压Natives文件</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../SecondChapter/Intro.html"><strong aria-hidden="true">4.</strong> 第二章：账号部分</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../SecondChapter/OfflineLogin.html"><strong aria-hidden="true">4.1.</strong> 离线登录</a></li><li class="chapter-item expanded "><a href="../SecondChapter/MicrosoftLogin.html"><strong aria-hidden="true">4.2.</strong> 微软登录</a></li><li class="chapter-item expanded "><a href="../SecondChapter/OAuthLogin.html"><strong aria-hidden="true">4.3.</strong> 微软OAuth登录</a></li><li class="chapter-item expanded "><a href="../SecondChapter/AuthlibInjectorLogin.html"><strong aria-hidden="true">4.4.</strong> Authlib-Injector第三方登录</a></li><li class="chapter-item expanded "><a href="../SecondChapter/RefreshLogin.html"><strong aria-hidden="true">4.5.</strong> 刷新账号</a></li><li class="chapter-item expanded "><a href="../SecondChapter/OfflineSkin.html"><strong aria-hidden="true">4.6.</strong> 离线登录皮肤</a></li></ol></li><li class="chapter-item expanded "><a href="../ThirdChapter/Intro.html"><strong aria-hidden="true">5.</strong> 第三章：下载部分</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../ThirdChapter/GetMCData.html"><strong aria-hidden="true">5.1.</strong> 获取MC元数据</a></li><li class="chapter-item expanded "><a href="../ThirdChapter/DownloadLibraries.html" class="active"><strong aria-hidden="true">5.2.</strong> 下载libraries</a></li><li class="chapter-item expanded "><a href="../ThirdChapter/DownloadAssets.html"><strong aria-hidden="true">5.3.</strong> 下载assets</a></li><li class="chapter-item expanded "><a href="../ThirdChapter/SupportThread.html"><strong aria-hidden="true">5.4.</strong> 支持多线程下载</a></li><li class="chapter-item expanded "><a href="../ThirdChapter/LaunchDownloadMC.html"><strong aria-hidden="true">5.5.</strong> 启动自己下载过后的MC</a></li><li class="chapter-item expanded "><a href="../ThirdChapter/ModLoader/Intro.html"><strong aria-hidden="true">5.6.</strong> 模组加载器</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../ThirdChapter/ModLoader/SupportFabricQuilt.html"><strong aria-hidden="true">5.6.1.</strong> 支持Fabric、Quilt自动安装</a></li><li class="chapter-item expanded "><a href="../ThirdChapter/ModLoader/SupportNeoForge.html"><strong aria-hidden="true">5.6.2.</strong> 支持NeoForge自动安装</a></li></ol></li><li class="chapter-item expanded "><a href="../ThirdChapter/CompleteMissingFiles.html"><strong aria-hidden="true">5.7.</strong> 补全MC的缺失文件</a></li><li class="chapter-item expanded "><a href="../ThirdChapter/CheckFileHash.html"><strong aria-hidden="true">5.8.</strong> 校验文件的hash值</a></li></ol></li><li class="chapter-item expanded "><a href="../TutorWriteTime.html"><strong aria-hidden="true">6.</strong> 教程书写时间</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Let us Make A Minecraft Launcher</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="这一章节我将教会大家初步体验下载libraries的实现"><a class="header" href="#这一章节我将教会大家初步体验下载libraries的实现">这一章节我将教会大家初步体验下载Libraries的实现！</a></h1>
<h2 id="这一章节不仅仅是介绍下载libraries而且会介绍解析原版json并且下载原版jar的功能这点在后期下载forge的时候可能会稍有不同"><a class="header" href="#这一章节不仅仅是介绍下载libraries而且会介绍解析原版json并且下载原版jar的功能这点在后期下载forge的时候可能会稍有不同">这一章节不仅仅是介绍下载Libraries，而且会介绍解析原版json并且下载原版jar的功能。这点在后期下载Forge的时候可能会稍有不同。</a></h2>
<p>首先，要想知道如何下载Libraries，我们只需要知道一件事即可很轻松的下载了！</p>
<p>其实，在启动一章节中，我已经很明确的写了一个函数名字叫【ConvertNameToPath】，这个函数用于将版本json中的libraries键下的name键转换成path。</p>
<p>然而事实远远没有想的那么妙，在Forge以及一些老版本的MC中，我们很清楚的知道部分列表里是没有artifact键的，甚至有一些是只有name键在里面，而别的什么键都没有。</p>
<p>如此，我们就需要用到上述的函数了！</p>
<p>我们先来看看MC在1.16.5里面的版本json文件吧！这里我们只看一个键值（因为别的键值没有代表性。。）</p>
<pre><code class="language-json">    {
      "downloads": {
        "artifact": {
          "path": "org/lwjgl/lwjgl/3.2.1/lwjgl-3.2.1.jar",
          "sha1": "2bb514e444994c6fece99a21f76e0c90438e377f",
          "size": 317748,
          "url": "https://libraries.minecraft.net/org/lwjgl/lwjgl/3.2.1/lwjgl-3.2.1.jar"
        },
        "classifiers": {
          "natives-macos": {
            "path": "org/lwjgl/lwjgl/3.2.1/lwjgl-3.2.1-natives-macos.jar",
            "sha1": "5a4c271d150906858d475603dcb9479453c60555",
            "size": 39835,
            "url": "https://libraries.minecraft.net/org/lwjgl/lwjgl/3.2.1/lwjgl-3.2.1-natives-macos.jar"
          }
        }
      },
      "name": "org.lwjgl:lwjgl:3.2.1",
      "natives": {
        "osx": "natives-macos"
      },
      "rules": [
        {
          "action": "allow",
          "os": {
            "name": "osx"
          }
        }
      ]
    },
</code></pre>
<p>这是其中一个libraries下的键值，我们可以很轻松的看见，里面是有downloads -&gt; artifact键值的，但是我们需要考虑一种情况，假如没有这个键值应该怎么办呢？</p>
<p>或者还有downloads -&gt; classifiers这个键值，这个键值的意思指的是MC需要解压的natives本地库文件。这个我们在启动一章的时候说过了，我们需要检测这里面的classifiers键值来解压本地库。这个同样也是需要我们下载的！</p>
<p>我们首先来看artifact键值，可以看到里面有4个键值，第一个是path，这个的意思是保存目录的意思，通常保存在{minecraft}\libraries{path}中。</p>
<p>下一个键值是sha1，这个我们目前先不用理会，后期我们会有专门的一章：【校验文件的hash值】这一章会着重讲解这个键值。</p>
<p>下一个是size，这个的意思是该文件总大小，<strong>也就是TotalSize</strong>，并不是指的是占用大小噢！我们后期教到多线程下载的时候，会根据这个值对网络文件进行切分下载。</p>
<p>下一个是url，这个键值是一个完整的url形式的键值，我们可以从该url中下载到该库。</p>
<p>再接着，我们再来看看下面的<strong>classifiers</strong>键值，我们可以看到里面有一个【natives-macos】，这个的意思就是这个本地库是苹果系统专属的类库，我们在Windows操作系统上暂时不需要它。</p>
<p>但是这里有个问题，这里有个键名，这个键名就是<strong>natives-macos</strong>，那么这个键名我们又该如何获取呢？</p>
<p>很简单，我们可以看看在这一整个代码块中有一个<strong>natives</strong>键，这个键里面会有【osx、windows、linux】3种键值，我们可以直接读取里面的键值，然后就可以读取classifiers下的键值了！</p>
<p>我们接着看下面有个rules键，这个键想必之前我在启动那一大章讲过了，这个是用来判断该库适用于什么操作系统的，拿我的示例来说，这个的意思其实就是<strong>only macos</strong>的意思。</p>
<p>介绍了这么多，想必各位应该懂得了启动器应该怎么解析这些库并且提取出URL了吧！</p>
<p>噢，对了，我们还需要一个下载进度条显示的窗口，这个窗口我们依旧单独设立一个：</p>
<p><img src="./image/prograssForm.png" alt="进度条窗口" /></p>
<p>这个窗口里面，我们设置了一个【隐藏详情】，其实就是把列表框隐藏掉，这样在遍历文件的时候会更快一些。</p>
<p>然后还有一个清空列表框。下载进度提示标签，下载进度条和一个Tips。</p>
<p>下面我会给大家打一段代码，详细教教应该怎么弄：</p>
<pre><code class="language-cs">//Button1是开始下载的按钮。
procedure TForm3.Button1Click(Sender: TObject);
begin
  //前面省去了一些判断列表框里的元素以及最大线程滑动条是否输入正确的代码。
  //在这里，我们使用versionPath和minecraftPath来表示{minecraft}\versions\{versionname}和{minecraft}根目录的意思。
  //这里的versionPath是由【{minecraftPath}\versions\】加上窗口文本框里的文本拼接而成的
  //上述，大家可以自行尝试制作一个版本管理部分来实现替换这两个变量的代码噢！
  //这里省去了判断（
  if not DirectoryExists(versionPath) then ForceDirectories(versionPath); 
  //此时版本文件夹应该还没有生成。这里判断文件夹是否存在，如果不存在则强制生成一次。
  Form4.Show; //这里直接将下载进度条框给展示出来。
  if ListBox2.ItemIndex &lt;&gt; -1 then begin
    //TODO：制作加载器等的安装。
  end else begin //only原版
    TTask.Run(procedure begin //定义一个线程。
      Form4.ListBox1.ItemIndex := Form4.ListBox1.Items.Add('已检测出下载的是：原版');
      
    end);
  end;
end;
</code></pre>
<p>切记，上述出现了一句话：【<font color=red>省去了判断</font>】，这个的意思就是说<font color=yellow>以下【变量/函数/过程】我们本来就是从始至终都没有在教程中出现的，需要各位自己根据本教程的注释内容进行替换。</font><font color=red>所以大家自行查看原文的代码注释中是否出现了这一句噢</font></p>
<p>随后，我们单独在那个else代码块里面开始写代码【因为我们现在主要是教下载原版】</p>
<pre><code class="language-cs">  var jurl := urlsl[Form3.ListBox1.ItemIndex]; //获取下载链接
  //这里本来应该有一个判断，因为我们需要删除{minecraftpath}\versions\{versionpath}下的所有文件，因此我们可能需要设置一个信息框让用户点击确定。
  DeleteDirectory(versionPath); //这个函数的意思是删掉该文件夹，包括文件夹里面的所有文件的函数，各位用自己熟悉的编程语言实现一次就好了！
  if not DirectoryExists(versionPath) then ForceDirectories(versionPath);//这里我们重新生成一次该文件夹。如果文件夹的确不存在的话。
  case tsd of //使用case判断下载源。这里仅仅只需要
    1: Form4.ListBox1.ItemIndex := Form4.ListBox1.Items.Add('已检测出下载源：官方源');
    2: begin
      jurl := jurl.Replace('https://piston-meta.mojang.com', 'https://bmclapi2.bangbang93.com');
      Form4.ListBox1.ItemIndex := Form4.ListBox1.Items.Add('已检测出下载源：BMCLAPI');
    end;
    3: begin
      jurl := jurl.Replace('https://piston-meta.mojang.com', 'https://download.mcbbs.net');
      Form4.ListBox1.ItemIndex := Form4.ListBox1.Items.Add('已检测出下载源：MCBBS');
    end;
  end;
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../ThirdChapter/GetMCData.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../ThirdChapter/DownloadAssets.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../ThirdChapter/GetMCData.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../ThirdChapter/DownloadAssets.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
