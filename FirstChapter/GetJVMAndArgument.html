<!DOCTYPE HTML>
<html lang="zh" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>如何获取jvm、game参数 - Let us Made a Minecraft Launcher</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../intro.html">导论</a></li><li class="chapter-item expanded affix "><li class="part-title">目录</li><li class="chapter-item expanded "><a href="../ProgrammingLanguage.html"><strong aria-hidden="true">1.</strong> 编程语言的选择</a></li><li class="chapter-item expanded "><a href="../LaunchPrinciple.html"><strong aria-hidden="true">2.</strong> 启动原理</a></li><li class="chapter-item expanded "><a href="../FirstChapter/intro.html"><strong aria-hidden="true">3.</strong> 第一章：启动游戏</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../FirstChapter/LaunchArguments.html"><strong aria-hidden="true">3.1.</strong> 讲解启动参数</a></li><li class="chapter-item expanded "><a href="../FirstChapter/GetVersionFolder.html"><strong aria-hidden="true">3.2.</strong> 如何获取versions文件夹</a></li><li class="chapter-item expanded "><a href="../FirstChapter/GetJVMAndArgument.html" class="active"><strong aria-hidden="true">3.3.</strong> 如何获取jvm、game参数</a></li><li class="chapter-item expanded "><a href="../FirstChapter/GetCpLibraries.html"><strong aria-hidden="true">3.4.</strong> 如何获取cp-library值</a></li><li class="chapter-item expanded "><a href="../FirstChapter/SupportInheritsFrom.html"><strong aria-hidden="true">3.5.</strong> 支持inheritsFrom下的MC</a></li><li class="chapter-item expanded "><a href="../FirstChapter/LaunchGame/LaunchIntro.html"><strong aria-hidden="true">3.6.</strong> 启动游戏！</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../FirstChapter/LaunchGame/ReplaceTemplate.html"><strong aria-hidden="true">3.6.1.</strong> 替换字符串模板并启动游戏</a></li><li class="chapter-item expanded "><a href="../FirstChapter/LaunchGame/UnzipNative.html"><strong aria-hidden="true">3.6.2.</strong> 解压Natives文件</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../SecondChapter/Intro.html"><strong aria-hidden="true">4.</strong> 第二章：账号部分</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../SecondChapter/OfflineLogin.html"><strong aria-hidden="true">4.1.</strong> 离线登录</a></li><li class="chapter-item expanded "><a href="../SecondChapter/MicrosoftLogin.html"><strong aria-hidden="true">4.2.</strong> 微软登录</a></li><li class="chapter-item expanded "><a href="../SecondChapter/OAuthLogin.html"><strong aria-hidden="true">4.3.</strong> 微软OAuth登录</a></li><li class="chapter-item expanded "><a href="../SecondChapter/AuthlibInjectorLogin.html"><strong aria-hidden="true">4.4.</strong> Authlib-Injector第三方登录</a></li><li class="chapter-item expanded "><a href="../SecondChapter/RefreshLogin.html"><strong aria-hidden="true">4.5.</strong> 刷新账号</a></li><li class="chapter-item expanded "><a href="../SecondChapter/OfflineSkin.html"><strong aria-hidden="true">4.6.</strong> 离线登录皮肤</a></li></ol></li><li class="chapter-item expanded "><a href="../ThirdChapter/Intro.html"><strong aria-hidden="true">5.</strong> 第三章：下载部分</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../ThirdChapter/GetMCData.html"><strong aria-hidden="true">5.1.</strong> 获取MC元数据</a></li><li class="chapter-item expanded "><a href="../ThirdChapter/DownloadLibraries.html"><strong aria-hidden="true">5.2.</strong> 下载libraries</a></li><li class="chapter-item expanded "><a href="../ThirdChapter/DownloadAssets.html"><strong aria-hidden="true">5.3.</strong> 下载assets</a></li><li class="chapter-item expanded "><a href="../ThirdChapter/SupportThread.html"><strong aria-hidden="true">5.4.</strong> 支持多线程下载</a></li><li class="chapter-item expanded "><a href="../ThirdChapter/LaunchDownloadMC.html"><strong aria-hidden="true">5.5.</strong> 启动自己下载过后的MC</a></li><li class="chapter-item expanded "><a href="../ThirdChapter/ModLoader/Intro.html"><strong aria-hidden="true">5.6.</strong> 模组加载器</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../ThirdChapter/ModLoader/SupportFabricQuilt.html"><strong aria-hidden="true">5.6.1.</strong> 支持Fabric、Quilt自动安装</a></li><li class="chapter-item expanded "><a href="../ThirdChapter/ModLoader/SupportNeoForge.html"><strong aria-hidden="true">5.6.2.</strong> 支持NeoForge自动安装</a></li></ol></li><li class="chapter-item expanded "><a href="../ThirdChapter/CompleteMissingFiles.html"><strong aria-hidden="true">5.7.</strong> 补全MC的缺失文件</a></li><li class="chapter-item expanded "><a href="../ThirdChapter/CheckFileHash.html"><strong aria-hidden="true">5.8.</strong> 校验文件的hash值</a></li></ol></li><li class="chapter-item expanded "><a href="../TutorWriteTime.html"><strong aria-hidden="true">6.</strong> 教程书写时间</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Let us Made a Minecraft Launcher</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="本页将教会大家如何查询并且拼接jvm和arguments默认启动参数"><a class="header" href="#本页将教会大家如何查询并且拼接jvm和arguments默认启动参数">本页将教会大家如何查询并且拼接JVM和Arguments默认启动参数</a></h1>
<p>首先，在Minecraft的版本中，分为这两类启动版本：</p>
<ol>
<li>≤1.12.2</li>
<li>≥1.13</li>
</ol>
<p>这两种启动版本的Json文件很不一样，同时，还有一个地方要注意：</p>
<ul>
<li>≤1.12.2——LiteLoader</li>
</ul>
<p>我将会直接将其统一放进同一个函数里，因为只需要判定某一个参数即可。所以几乎无需多余的判定。</p>
<p>首先我们要点进Minecraft的1.19.4的版本json文件进行查看。我们可以看到内容大致如下：</p>
<pre><code class="language-json">{
  &quot;arguments&quot;: {
    &quot;game&quot;: [ //有rule的参数为额外参数，直接拼接在game列表中的则是默认参数
      &quot;--username&quot;,
      &quot;${auth_player_name}&quot;,
      ... //其为默认游戏参数【game默认参数在开头】
      { 
        &quot;rules&quot;: [
          {
            &quot;action&quot;: &quot;allow&quot;,
            &quot;features&quot;: {
              &quot;is_demo_user&quot;: true
            }
          }
        ],
        &quot;value&quot;: &quot;--demo&quot;
      },
      ... //其为额外游戏参数
    ],
    &quot;jvm&quot;: [
      { //jvm的额外参数在顶上，默认参数在下面。
        /*
          有部分JVM参数包含rules键值，我们在拼接启动参数的时候需要考虑这种情况：
          1.rules是一个Json列表的形式
          2.如果rules里面有一个值的action为disallow，则在这以下的os键值对里的name所指代的操作系统无需拼接此参数。反之亦然。
          3.有些rules键值里面的value是个数组类型，我们在实际情况下也应该考虑这种情况。
        */
        &quot;rules&quot;: [
          {
            &quot;action&quot;: &quot;allow&quot;,
            &quot;os&quot;: {
              &quot;name&quot;: &quot;osx&quot;
            }
          }
        ],
        &quot;value&quot;: [
          &quot;-XstartOnFirstThread&quot;
        ]
      },
      ... //其为额外jvm参数，其中由os键中的osx代表的是Macos的参数，linux则是Linux的参数，windows则是Windows参数，arch: x86则代表了32位系统。
      // 然后，version键值只在Windows出现，而且：【^10\】代表了其需要Windows 10版本以上才需要添加。
      &quot;-Djava.library.path=${natives_directory}&quot;,
      ... //其为默认jvm参数
    ]
  },
  &quot;assetIndex&quot;: {
    &quot;id&quot;: &quot;3&quot;,
    &quot;sha1&quot;: &quot;0e432ccd3ef65853034193811d92ac47d0b7ca5d&quot;,
    &quot;size&quot;: 409894,
    &quot;totalSize&quot;: 555638139, 
    &quot;url&quot;: &quot;https://piston-meta.mojang.com/v1/packages/0e432ccd3ef65853034193811d92ac47d0b7ca5d/3.json&quot;
  }, //其为Minecraft所需要的资源索引json文件。
  &quot;assets&quot;: &quot;3&quot;,
  &quot;complianceLevel&quot;: 1,
  &quot;downloads&quot;: {
    &quot;client&quot;: {
      &quot;sha1&quot;: &quot;958928a560c9167687bea0cefeb7375da1e552a8&quot;,
      &quot;size&quot;: 23476620,
      &quot;url&quot;: &quot;https://piston-data.mojang.com/v1/objects/958928a560c9167687bea0cefeb7375da1e552a8/client.jar&quot;
    }, 
    ... //其为Minecraft所需要的原版jar文件和原版mapping映射表下载地址。
  },
  &quot;id&quot;: &quot;1.19.4&quot;, //其为Minecraft的游戏id【一般随着Minecraft的版本命名而区分。】
  &quot;javaVersion&quot;: {
    &quot;component&quot;: &quot;java-runtime-gamma&quot;,
    &quot;majorVersion&quot;: 17
  }, //其为Minecraft所需要的Java运行时环境，component为MC官方提供的下载源中需要的环境依赖。【这个后期说道自动下载Java时会说道。】
  &quot;libraries&quot;: [
    {
      &quot;downloads&quot;: {
        &quot;artifact&quot;: {
          &quot;path&quot;: &quot;ca/weblite/java-objc-bridge/1.1/java-objc-bridge-1.1.jar&quot;,
          &quot;sha1&quot;: &quot;1227f9e0666314f9de41477e3ec277e542ed7f7b&quot;,
          &quot;size&quot;: 1330045,
          &quot;url&quot;: &quot;https://libraries.minecraft.net/ca/weblite/java-objc-bridge/1.1/java-objc-bridge-1.1.jar&quot;
        }
      },
      ... //其为Minecraft所需的所有类库文件，其中包含了资源名称，downloads键下还有artifact键，里面有资源保存路径、资源sha1、资源大小、资源下载网址等。
      /*
        有部分类库文件包含rules键值，我们在拼接启动参数的时候需要考虑这种情况：
        1.rules是一个Json列表的形式
        2.如果rule里面有一个值的action为disallow，则在这以下的os键值对里的name所指代的操作系统无需拼接此参数。反之亦然。
      */
    }
  ],
  &quot;logging&quot;: {
    &quot;client&quot;: {
      &quot;argument&quot;: &quot;-Dlog4j.configurationFile=${path}&quot;,
      &quot;file&quot;: {
        &quot;id&quot;: &quot;client-1.12.xml&quot;,
        &quot;sha1&quot;: &quot;bd65e7d2e3c237be76cfbef4c2405033d7f91521&quot;,
        &quot;size&quot;: 888,
        &quot;url&quot;: &quot;https://piston-data.mojang.com/v1/objects/bd65e7d2e3c237be76cfbef4c2405033d7f91521/client-1.12.xml&quot;
      },
      &quot;type&quot;: &quot;log4j2-xml&quot;
    } //Minecraft Log4J配置文件路径，这个一般时用于记录玩家客户端执行的，一般我们不需要将其包含进启动参数内，因此这一整个logging键值没用。
  },
  &quot;mainClass&quot;: &quot;net.minecraft.client.main.Main&quot;, //Minecraft主类【需要添加进启动参数】
  &quot;minimumLauncherVersion&quot;: 21, //Minecraft最小启动器版本【一般指的是官启版本（猜的】
  &quot;releaseTime&quot;: &quot;2023-03-14T12:56:18+00:00&quot;, //发布时间
  &quot;time&quot;: &quot;2023-03-14T12:56:18+00:00&quot;, //与上面相同
  &quot;type&quot;: &quot;release&quot; //发布类型【如果是snapshot，就会显示snapshot，但1.19.4是release发布版。】
}
</code></pre>
<p>以上是我们的Minecraft原版Json文件，这个文件如何获取的晚点我会和大家娓娓道来，大家只需要先学习我们如何根据这个Json文件进行启动游戏的就好了！</p>
<p>在使用Delphi自带的JSON库时，大家需要在自己的头文件中引用一个单元文件。键入以下单元即可：</p>
<pre><code class="language-cs">uses
  JSON;
</code></pre>
<p>然后，首先我们要写一个函数，这个函数的名字就叫做：【selectParam】</p>
<p>我们将这个函数放进我们的自制类里面。可以选择放在private，也可以选择放在public，那我这里就选择放在public里了吧！</p>
<pre><code class="language-cs">type
  TForm1 = class(TForm)
    Button1: TButton;
    ComboBox1: TComboBox;
    procedure FormCreate(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;
  Launcher = class
  private
  public
    function SelectParam(json: TJsonObject): string;
  end;
</code></pre>
<p>在Delphi里面，函数的意思是有返回值的方法，使用function定义，而过程是没有返回值的方法，用procedure定义。我们上面定义的是function，因此这是个函数。</p>
<p>然后，我们的参数列表中填入的是一个TJsonObject类型的，意味着我们这个参数是一个Json对象。我们需要将字符串转换成Json对象才能传参。</p>
<p>紧接着，我们就要开始实现这个函数了。我们在implementation下方依旧如同上方一样实现上述Launcher类里的SelectParam函数。请看示例</p>
<pre><code class="language-cs">function Launcher.SelectParam(json: TJsonObject): string;
begin //开头的函数得与你在类中定义的函数一致。  
  result := ''; //此处设置该函数返回值默认值为空值。
  var param := '-XX:+UseG1GC ' + //每一个参数末尾都需要加上空格。
  '-XX:-UseAdaptiveSizePolicy ' +
  '-XX:-OmitStackTraceInFastThrow ' +
  '-Dfml.ignoreInvalidMinecraftCertificates=True ' +
  '-Dfml.ignorePatchDiscrepancies=True ' +
  '-Dlog4j2.formatMsgNoLookups=true '; //这些都是我们需要的默认JVM参数。因为PCL2添加了这些参数，仅此而已啦！
  // param := param + additionJVM; 
  //该处，如果你想为Minecraft手动添加额外JVM参数，可以在这里写。同时参数也可以多添加一个additionJVM，类型String来添加。也可以添加全局变量。我就不添加了，我不太想。
  param := param + '-XX:HeapDumpPath=MojangTricksIntelDriversForPerformance_javaw.exe_minecraft.exe.heapdump '; //由于我们这个启动器面向的是Windows，自然，对于Windows的这个额外JVM参数，我们需要将其当作默认JVM参数添加进入。
  if Win32MajorVersion = 10 then param := param + '&quot;-Dos.name=Windows 10&quot; -Dos.version=10.0 ' ;
  //该处使用了Delphi内置函数Win32MajorVersion来判断电脑的操作系统版本，如果是Windows10，则拼接下面两个参数，反之不拼接。
  var judge: boolean; //在外部定义一个judge判断布尔变量
  var argu: TJsonObject; //在外部定义一个argu的Json对象变量。
  try
    judge := false; //给外部定义的judge变量初值设为false。
    argu := json.GetValue('arguments') as TJsonObject; //通过传入的Json参数获取里面的arguments键，然后将其转换成Json对象形式。传到外面。
    var jvm := argu.GetValue('jvm') as TJsonArray; //再通过arguments对象进入jvm键值对里面，将其转换成Json数组。
    if jvm.Count = 0 then raise Exception.Create('No jvm arguments'); //如果jvm列表内元素为空，则抛出报错，执行except语句，将judge返回true。
    for var i in jvm do begin //使用循环遍历jvm参数
      if i.ToString.IndexOf('rules') &lt;&gt; -1 then continue; //一旦遇到了rules键值，则判定此为额外JVM参数，故暂不添加进param中。
      param := param + i.Value.Trim + ' '; //末尾需要加上空格。并且需要去除掉在默认参数中的空格。
    end;
  except
    judge := true; //如果找不到arguments键，或者arguments键中的jvm值不存在，或者为空，则抛出报错。
  end; 
  if judge then begin //如果judge为true，意味着上面jvm参数拼接失败，则执行。
    param := param + ' -Djava.library.path=${natives_directory} -cp ${classpath} ';
    judge := false;
  end; //上述代码为Minecraft主动添加了JVM参数，此处一般是用于判断版本是否小于1.12.2。
  param := param + '${authlib_injector_param}'; //这里需要添加一个Authlib-Injector，这个我们晚点再说！晚点到登录到Authlib-Injector时再说吧！
  try
    param := param + '-Xmn256m -Xmx' + MaxMemory + 'm ' + json.GetValue('mainClass').Value + ' '; 
    //上述代码给MC启动参数总添加了几行默认游戏参数，其中包括了最小内存、最大内存、主类。且如果无法从json文件中找到mainClass键，则抛出报错。错误见下。
  except
    messagebox(0, '无法拼接mainClass主类参数，参数拼接失败。', '无法拼接参数', MB_ICONERROR); //此处显示一个信息框，无法拼接主类参数。
    exit; //退出该函数。
  end;
  try //该try语句是适配1.13版本以上的版本。
    var game := argu.GetValue('game') as TJsonArray; //进入了arguments后，我们再接着通过这个arguments对象进入game键值对里面，然后将其转换成Json数组形式。
    if game.Count = 0 then raise Exception.Create('No game arguments');
    for var i in game do begin //使用相同的手段将game参数拼接到jvm参数的后面。
      if i.ToString.IndexOf('rules') &lt;&gt; -1 then continue;
      param := param + i.Value.Trim + ' '; 
      //末尾需要加上空格。并且需要去除掉在默认参数中的空格。目的请看Fabric的版本Json文件。其中有一个-DFabricMcEmu键，后面跟了空格，因此这里需要对此进行空格清除。
    end;
  except
  end;
  try //在这里实则判断param中是否有minecraftArguments值，以适配1.12.2以下版本
    var mcargu := json.GetValue('minecraftArguments').Value; //开始判断是否有
    if mcargu = '' then raise Exception.Create('No 1.12.2 Arguments'); 
    //如果没有这个键，或者这个键为空，则抛出报错，自动执行except语句，然后except语句内啥也没有，就接着往下执行。
    param := param + mcargu; //此处如果有则拼接这个参数。
    //json中的键值对'minecraftArguments'就是在1.12.2以下版本所用的启动参数。这一串代码实则判断假如MC版本小于等于1.12.2，则主动拼接这个参数。
  except //此处不用设置judge了。
  end;
  if judge then begin //此处为当未能拼接任意默认游戏参数时抛出的报错。
    messagebox(0, '无法拼接默认游戏参数，参数拼接失败。', '无法拼接参数', MB_ICONERROR); //这里置一个信息框。
    exit; //退出该函数
  end;
  result := param; //将参数当作返回值返回。
end;
</code></pre>
<p>我相信，这些注释足以使玩家明白其中的道理。如果大家觉得用电子书没有换行看着太麻烦，大家可以将其复制进记事本中慢慢观看哦！</p>
<p>噢，好像发现了一件事！我通过查看PCL2的源码时，发现了一个非常神奇的一幕：请看截图：
<img src="./image/PCL2.png" alt="PCL2启动参数" /></p>
<p>我们在这个截图里，发现了其实在拼接Optifine Forge和仅安装了Optifine的时候，参数里可能会有两个或以上的--tweakClass作为启动参数，然后Optifine可能不会是最后一个，因此我们需要手动将该参数放到最后，这样才不会启动失败！</p>
<p>我们首先来尝试一下：</p>
<pre><code class="language-cs">  ...//前面的代码：我们直接在我们上面的result := param的上面一句直接写：
  if param.Contains('--tweakClass optifine.OptiFineTweaker') or param.Contains('--tweakClass optifine.OptiFineForgeTweaker') then begin
    param := param.Replace('--tweakClass optifine.OptiFineTweaker', '').Replace('--tweakClass optifine.OptiFineForgeTweaker', '') + '--tweakClass optifine.OptifineForgeTweaker';
  end;
  result := param;
</code></pre>
<p>简单来说，上面的函数我们一句参数，我们将optifine的tweakClass放到最后了！就是首先replace掉所有的--tweakClass optifine的，然后将正确的参数拼接在后面。</p>
<p>我们上述的代码中，其实已经将所有的版本都支持进去了，<font color=red>包括forge、Fabric、Quilt、LiteLoader等都可以正常的拼接启动参数了。包括MC的从远古版本到最新版本的启动参数支持都在这一个函数里哦！</font></p>
<p>大家只需要看个逻辑就好，完全可以翻译成自己的编程语言进行开发哦！现在大家能领略Delphi的魅力了吗？与C#、Java等语言是否觉得比较相同呢？</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../FirstChapter/GetVersionFolder.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../FirstChapter/GetCpLibraries.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../FirstChapter/GetVersionFolder.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../FirstChapter/GetCpLibraries.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>